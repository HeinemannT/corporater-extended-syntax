{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Extended",
  "scopeName": "source.extended",
  "patterns": [
    {
      "comment": "EMBEDDED HTML: Triggered by strings starting with '<' or assigned to variables ending in 'Html'/'Body'",
      "begin": "(?x) (?: (?<=\\b[a-zA-Z0-9_]*[Hh]tml\\s{0,10}:=\\s{0,10}) | (?<=\\b[a-zA-Z0-9_]*[Bb]ody\\s{0,10}:=\\s{0,10}) ) (\"|') | (\"|')(?=\\s*<[a-zA-Z])",
      "end": "\\1|\\2",
      "name": "string.quoted.extended.embedded.html",
      "patterns": [
        {
          "match": "\\\\.",
          "name": "constant.character.escape.extended"
        },
        {
          "match": "\\$\\{[a-zA-Z0-9_\\.]+\\}",
          "name": "variable.other.interpolation.extended"
        },
        {
          "include": "text.html.basic"
        }
      ]
    },
    {
      "comment": "EMBEDDED CSS: Triggered by variables ending in 'Style'",
      "begin": "(?x) (?<=\\b[a-zA-Z0-9_]*[S]tyle\\s{0,10}:=\\s{0,10}) (\"|')",
      "end": "\\1",
      "name": "string.quoted.extended.embedded.css",
      "patterns": [
        {
          "match": "\\\\.",
          "name": "constant.character.escape.extended"
        },
        {
          "match": "\\$\\{[a-zA-Z0-9_\\.]+\\}",
          "name": "variable.other.interpolation.extended"
        },
        {
          "include": "source.css"
        }
      ]
    },
    {
      "comment": "EMBEDDED JSON: Triggered by strings starting with '{' or variables ending in 'Json'",
      "begin": "(?x) (?: (?<=\\b[a-zA-Z0-9_]*[Jj]son\\s{0,10}:=\\s{0,10}) (\"|') | (\"|')(?=\\s*\\{) )",
      "end": "\\1|\\2",
      "name": "string.quoted.extended.embedded.json",
      "patterns": [
        {
          "match": "\\\\.",
          "name": "constant.character.escape.extended"
        },
        {
          "match": "\\$\\{[a-zA-Z0-9_\\.]+\\}",
          "name": "variable.other.interpolation.extended"
        },
        {
          "include": "source.json"
        }
      ]
    },
    {
      "comment": "ILLEGAL: Inline IF assignments must be wrapped in brackets (e.g., v := (IF...))",
      "match": "(?<=:=)\\s*\\bIF\\b",
      "name": "invalid.illegal.missing-brackets.extended"
    },
    {
      "comment": "ILLEGAL: Universal NOT operator is not supported (only works with IN/CONTAINS)",
      "match": "\\bNOT\\b\\s*(?!IN|CONTAINS)",
      "name": "invalid.illegal.extended"
    },
    {
      "comment": "Output Wrapper (Debug)",
      "match": "\\boutput(?=\\()",
      "name": "entity.name.function.debugger.extended"
    },
    {
      "comment": "Expression Call {myExpression} - Strict regex rejects quotes/JSON",
      "match": "\\{[a-zA-Z0-9_]+\\}",
      "name": "entity.name.function.call.extended"
    },
    {
      "comment": "Variable Interpolation ${...}",
      "match": "\\$\\{[a-zA-Z0-9_\\.]+\\}",
      "name": "variable.other.interpolation.extended"
    },
    {
      "comment": "DocBlock Tags",
      "match": "(?<=/\\*\\s*)(Name|Tags|Explanation|Note)(?=:)",
      "name": "keyword.other.documentation.extended"
    },
    {
      "comment": "Comments: Single line",
      "match": "//.*$",
      "name": "comment.line.double-slash.extended"
    },
    {
      "comment": "Comments: Multi line",
      "begin": "/\\*",
      "end": "\\*/",
      "name": "comment.block.extended"
    },
    {
      "comment": "Strings: Double quotes",
      "begin": "\"",
      "end": "\"",
      "name": "string.quoted.double.extended",
      "patterns": [
        {
          "match": "\\\\.",
          "name": "constant.character.escape.extended"
        }
      ]
    },
    {
      "comment": "Strings: Single quotes",
      "begin": "'",
      "end": "'",
      "name": "string.quoted.single.extended",
      "patterns": [
        {
          "match": "\\\\.",
          "name": "constant.character.escape.extended"
        }
      ]
    },
    {
      "comment": "Control Flow Keywords",
      "match": "\\b(IF|THEN|ELSE|ENDIF|SELECT|FROM|WHERE)\\b",
      "name": "keyword.control.extended"
    },
    {
      "comment": "Logical Operators",
      "match": "\\b(AND|OR|NOT|IN|CONTAINS)\\b",
      "name": "keyword.operator.logical.extended"
    },
    {
      "comment": "Assignment Operator",
      "match": ":=",
      "name": "keyword.operator.assignment.extended"
    },
    {
      "comment": "Comparison Operators",
      "match": "(?<!:)=|!=|<>|>=|<=|>|<|\\+|\\-|\\*|/|%",
      "name": "keyword.operator.comparison.extended"
    },
    {
      "comment": "Context Keywords (including 'after' for transactional callbacks)",
      "match": "\\b(this|self|after)\\.(object|organisation|user|start|end|bop|eop|inputView|inputViews)\\b|\\b(after)\\b",
      "name": "variable.language.context.extended"
    },
    {
      "comment": "Input View Keys (key_ prefix)",
      "match": "\\bkey_[a-zA-Z0-9_]+\\b",
      "name": "variable.other.custom.inputkey.extended"
    },
    {
      "comment": "Global Constants",
      "match": "\\b(MISSING|TRUE|FALSE|TODAY|BOP|EOP|BOY|EOY|NULL|NA|NaN)\\b",
      "name": "constant.language.extended"
    },
    {
      "comment": "Custom Variables (_prefix)",
      "match": "\\b_[a-zA-Z0-9_]+\\b",
      "name": "variable.other.custom.underscore.extended"
    },
    {
      "comment": "Custom Variables (vPrefix)",
      "match": "\\bv[A-Z][a-zA-Z0-9_]*\\b",
      "name": "variable.other.custom.vprefix.extended"
    },
    {
      "comment": "Table & Style Constants (including Status Choices)",
      "match": "\\b(LEFT|RIGHT|CENTER|VISIBLE|NOVISIBLE|ADMINVISIBLEONLY|VISIBLEASPARENTONLY|wrapped|full|truncated|separator|percentage|thousands|date|duration|RED|AMBER|GREEN|BLUE|GREY)\\b",
      "name": "constant.other.style.extended"
    },
    {
      "comment": "System Properties",
      "match": "\\.(id|name|description|className|linkedTo|parent|createdTime|createdBy|lastModifiedDate|lastModifiedBy|visible|inheritVisible|inScope|inheritScope|available|inheritAvailable|expression|statusClassification|responsible|email|inputset|rid|long|formatted|weight|unit|period|indexOrder)(?=\\b)",
      "name": "variable.other.property.system.extended"
    },
    {
      "comment": "Configuration Properties",
      "match": "\\b(decimalPlaces|formatPostfix|allowBlank|listPropertySet|multiselect|advanced|listDisplayType|overrideTableName|referenceModel|types|property|filter|propertyReadonly|viewTypes|sortVisibility|columnsLargeScreen|columnsMediumScreen|columnsSmallScreen|borderStyle|createMode|objectType|parentDestinationExpression|editPage|propertyMapping|required|propertyHint|inputSet|buttonType|destinationExpression|afterExpression)(?=\\s*:=)",
      "name": "variable.parameter.configuration.extended"
    },
    {
      "comment": "Global Functions",
      "match": "\\b(LIST|MAP|AGG|abs|cbrt|ceil|floor|pow|round|sqrt|md|num|str|priority|createtable|date)\\b",
      "name": "support.function.global.extended"
    },
    {
      "comment": "Transactional Methods (Write)",
      "match": "\\.(add|affixLink|change|clear|copy|delete|error|generate|link|move|moveAfter|moveBefore|notify|reset|sendmail|start|unlink|update)(?=\\()",
      "name": "storage.type.method.transactional.extended"
    },
    {
      "comment": "Object & List Methods (Read)",
      "match": "\\.(ancestor|as|avg|calculate|children|count|descendants|distinct|filter|first|forEach|get|groupBy|indexOf|isMissing|item|join|last|map|max|merge|min|rref|remove|reverse|size|sort|sortReverse|strip|substring|sum|tree|union|url|whenMissing)(?=\\()",
      "name": "support.function.method.extended"
    },
    {
      "comment": "Table Methods",
      "match": "\\.(addColumn|addTimeColumns|addRow|align|collapse|decimals|formattype|hidden|indent|postfix|prefix|readonly|style|table)(?=\\()",
      "name": "support.function.table.extended"
    },
    {
      "comment": "Explicit Model Roots",
      "match": "\\broot\\.(accessPolicy|accessProfile|actionPlan|ceAsset|ceAttachment|ceIndicator|ceRiskAssessment|classConfig|custom_Period|defaults|expression|externalResource|forms|group|node|nodeDataImport|nodeType|notification|organisation|page|portal|processManagement|property|reporter|risk|role|templateCategory|transformer|user)\\b",
      "name": "entity.name.class.root.extended"
    },
    {
      "comment": "ID Space Prefixes",
      "match": "\\b(ap|c|d|g|k|n|ndi|nt|o|p|r|rt|t|u|ceven|cetas|cecom|ceinc|cepro|cepol|cecme|ceiss|ceass|ceser|cecot|ceprj|cereg|cecor|ceind|ceatt|ceras|acpol|role|ceprd|sa|cepsc|ceprv|cewfl|cedis|ceinq|ceqst|cedpi|cetia|ceasa|fas)\\.(?=[a-zA-Z0-9_]+)",
      "name": "entity.name.type.namespace.extended"
    },
    {
      "comment": "Numbers",
      "match": "\\b\\d+(\\.\\d+)?\\b",
      "name": "constant.numeric.extended"
    }
  ]
}