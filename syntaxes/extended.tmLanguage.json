{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Extended",
  "scopeName": "source.extended",
  "patterns": [
    {
      "comment": "Expression Call {myExpression} - Action Runner Brackets (Green). Must be TOP PRIORITY.",
      "match": "(\\{)([a-zA-Z0-9_]+)(\\})",
      "captures": {
        "1": { "name": "punctuation.section.brackets.runner.extended" },
        "2": { "name": "entity.name.function.runner.extended" },
        "3": { "name": "punctuation.section.brackets.runner.extended" }
      }
    },
    {
      "comment": "Action Runners (start, expression)",
      "match": "\\.(start)(?=\\()|\\.(expression)(?=\\b)",
      "name": "entity.name.function.runner.extended"
    },
    {
      "comment": "Transactional Methods (Write/Danger)",
      "match": "\\.(add|affixLink|change|clear|copy|delete|error|generate|link|move|moveAfter|moveBefore|notify|reset|sendmail|unlink|update)(?=\\()",
      "name": "storage.type.method.transactional.extended"
    },
    {
      "comment": "DocBlock Tags",
      "match": "(?<=/\\*\\s*)(Name|Tags|Explanation|Note)(?=:)",
      "name": "keyword.other.documentation.extended"
    },
    {
      "comment": "Comments: Single line",
      "match": "//.*$",
      "name": "comment.line.double-slash.extended"
    },
    {
      "comment": "Comments: Multi line",
      "begin": "/\\*",
      "end": "\\*/",
      "name": "comment.block.extended"
    },
    {
      "comment": "ILLEGAL: Inline IF assignments must be wrapped",
      "match": "(?<=:=)\\s*\\bIF\\b",
      "name": "invalid.illegal.missing-brackets.extended"
    },
    {
      "comment": "ILLEGAL: Universal NOT",
      "match": "\\bNOT\\b\\s*(?!IN|CONTAINS)",
      "name": "invalid.illegal.extended"
    },
    {
      "comment": "Output Wrapper",
      "match": "\\boutput(?=\\()",
      "name": "entity.name.function.debugger.extended"
    },
    {
      "comment": "Variable Interpolation",
      "match": "\\$\\{[a-zA-Z0-9_\\.]+\\}",
      "name": "variable.other.interpolation.extended"
    },
    {
      "comment": "Control Flow Keywords",
      "match": "\\b(IF|THEN|ELSE|ENDIF|SELECT|FROM|WHERE)\\b",
      "name": "keyword.control.extended"
    },
    {
      "comment": "Logical Operators",
      "match": "\\b(AND|OR|NOT|IN|CONTAINS)\\b",
      "name": "keyword.operator.logical.extended"
    },
    {
      "comment": "Comparison Operators",
      "match": "(?<!:)=|!=|<>|>=|<=|>|<|\\+|\\-|\\*|/|%",
      "name": "keyword.operator.comparison.extended"
    },
    {
      "comment": "Strings: Double quotes",
      "begin": "\"",
      "end": "\"",
      "name": "string.quoted.double.extended",
      "patterns": [ { "match": "\\\\.", "name": "constant.character.escape.extended" } ]
    },
    {
      "comment": "Strings: Single quotes",
      "begin": "'",
      "end": "'",
      "name": "string.quoted.single.extended",
      "patterns": [ { "match": "\\\\.", "name": "constant.character.escape.extended" } ]
    },
    {
      "comment": "Context Keywords",
      "match": "\\b(this|self|after)\\.(object|organisation|user|start|end|bop|eop|inputView|inputViews)\\b|\\b(after|self)\\b",
      "name": "variable.language.context.extended"
    },
    {
      "comment": "Input View Keys",
      "match": "\\bkey_[a-zA-Z0-9_]+\\b",
      "name": "variable.other.custom.inputkey.extended"
    },
    {
      "comment": "Global Constants",
      "match": "\\b(MISSING|TRUE|FALSE|TODAY|BOP|EOP|BOY|EOY|NULL|NA|NaN)\\b",
      "name": "constant.language.extended"
    },
    {
      "comment": "Global Functions",
      "match": "\\b(LIST|MAP|AGG|abs|cbrt|ceil|floor|pow|round|sqrt|md|num|str|priority|createtable|date)\\b",
      "name": "support.function.global.extended"
    },
    {
      "comment": "Object & List Methods (Read)",
      "match": "\\.(ancestor|as|avg|calculate|children|count|descendants|distinct|filter|first|forEach|get|groupBy|indexOf|isMissing|item|join|last|map|max|merge|min|rref|remove|reverse|size|sort|sortReverse|strip|substring|sum|tree|union|url|whenMissing)(?=\\()",
      "name": "support.function.method.extended"
    },
    {
      "comment": "Table Methods",
      "match": "\\.(addColumn|addTimeColumns|addRow|align|collapse|decimals|formattype|hidden|indent|postfix|prefix|readonly|style|table)(?=\\()",
      "name": "support.function.table.extended"
    },
    {
      "comment": "Custom Variables (Unified Scope)",
      "match": "\\b(_[a-zA-Z0-9_]+|v[A-Z][a-zA-Z0-9_]*)\\b",
      "name": "variable.other.custom.extended"
    },
    {
      "comment": "Style Constants",
      "match": "\\b(LEFT|RIGHT|CENTER|VISIBLE|NOVISIBLE|ADMINVISIBLEONLY|VISIBLEASPARENTONLY|wrapped|full|truncated|separator|percentage|thousands|date|duration|RED|AMBER|GREEN|BLUE|GREY)\\b",
      "name": "constant.other.style.extended"
    },
    {
      "comment": "System Properties",
      "match": "\\.(id|name|description|className|linkedTo|parent|organisation|createdTime|createdBy|lastModifiedDate|lastModifiedBy|visible|inheritVisible|inScope|inheritScope|available|inheritAvailable|statusClassification|responsible|email|inputset|rid|long|formatted|weight|unit|period|indexOrder)(?=\\b)",
      "name": "variable.other.property.system.extended"
    },
    {
      "comment": "Configuration Properties",
      "match": "\\b(decimalPlaces|formatPostfix|allowBlank|listPropertySet|multiselect|advanced|listDisplayType|overrideTableName|referenceModel|types|property|filter|propertyReadonly|viewTypes|sortVisibility|columnsLargeScreen|columnsMediumScreen|columnsSmallScreen|borderStyle|createMode|objectType|parentDestinationExpression|editPage|propertyMapping|required|propertyHint|inputSet|buttonType|destinationExpression|afterExpression)(?=\\s*:=)",
      "name": "variable.parameter.configuration.extended"
    },
    {
      "comment": "Explicit Model Roots",
      "match": "\\broot\\.(accessPolicy|accessProfile|actionPlan|ceAsset|ceAttachment|ceIndicator|ceRiskAssessment|classConfig|custom_Period|defaults|expression|externalResource|forms|group|node|nodeDataImport|nodeType|notification|organisation|page|portal|processManagement|property|reporter|risk|role|templateCategory|transformer|user)\\b",
      "name": "entity.name.class.root.extended"
    },
    {
      "comment": "Known Object Types (Bold Green)",
      "match": "\\b(ActionPlan|Attachment|BarChart|BarLineChart|BPMNModelTable|Category|CeAsset|CeAttachment|CeComplianceRequirement|CeContract|CeControlMeasure|CeDistribution|CeDPIA|CeIncident|CeIndicator|CeInquiry|CeIssue|CePolicy|CePreScreening|CePrivacy|CeProcedure|CeProduct|CeProject|CeQuestionnaire|CeRegulation|CeRiskAssessment|CeService|CeTask|CeTia|CeVendor|CeWorkflow|Chart|Container|CreateObjectView|DescriptionView|EditField|EditPage|EnterpriseTemplate|ExtendedTable|FileResource|FilterTable|Folder|Form|Group|HistoricalBooleanMethodConfig|HistoricalDateMethodConfig|HistoricalListMethodConfig|HistoricalNumberMethodConfig|HistoricalReferenceMethodConfig|HistoricalRichTextMethodConfig|HistoricalTextMethodConfig|ImageView|Incident|IncidentList|InputSet|InputView|Kpi|LinkMap|ListMethodConfig|ListPropertySet|ListPropertySetItem|Node|Organisation|PieChart|ProcessIncidentTable|ProcessInstanceTable|ProcessTable|ReferenceMethodConfig|Report|Reporter|ReverseReferenceMethodConfig|Risk|RiskChart|Role|Scenario|ScenarioTable|Scorecard|Section|SelectionTable|ServiceAccount|Spacer|Survey|SystemMethodConfig|Tab|Tabset|TaskList|TemplateCategory|TextElement|TextMethodConfig|Transformer|User|UserTaskInstanceTable|WebChildReference)\\b",
      "name": "entity.name.class.extended"
    },
    {
      "comment": "ID Space Prefixes (ALL)",
      "match": "\\b(acpol|ap|ceasa|ceass|ceatt|cecom|cecor|cecot|cedis|cedpi|ceinq|ceinc|ceind|ceiss|cecme|cepol|ceprd|ceprj|cepro|ceprv|cepsc|ceqst|ceras|cereg|ceser|cetas|cetia|ceven|cewfl|c|d|ds|fas|g|k|ndi|nt|n|o|p|role|rt|r|sa|t|u)\\.(?=[a-zA-Z0-9_]+)",
      "name": "entity.name.type.namespace.extended"
    },
    {
      "comment": "Numbers",
      "match": "\\b\\d+(\\.\\d+)?\\b",
      "name": "constant.numeric.extended"
    },
    {
      "comment": "All Brackets (Red) - LAST PRIORITY so runner brackets aren't overridden",
      "match": "[\\(\\)\\[\\]\\{\\}]",
      "name": "punctuation.section.brackets.extended"
    }
  ]
}